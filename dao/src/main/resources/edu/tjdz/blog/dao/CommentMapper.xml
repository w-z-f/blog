<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.tjdz.blog.dao.CommentMapper">
  <resultMap id="BaseResultMap" type="edu.tjdz.blog.beans.bean.Comment">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Nov 25 14:17:15 CST 2021.
    -->

      <result column="comment_id" javaType="java.lang.Integer" jdbcType="INTEGER" property="commentId" />
      <result column="comment_content" javaType="java.lang.String" jdbcType="VARCHAR" property="commentContent" />
      <result column="tourist_name" javaType="java.lang.String" jdbcType="VARCHAR" property="touristName"/>
      <result column="tourist_img" javaType="java.lang.String" jdbcType="VARCHAR" property="touristImg"/>
      <result column="email" javaType="java.lang.String" jdbcType="VARCHAR" property="email"/>
      <result column="cre_time" javaType="java.util.Date" jdbcType="TIMESTAMP" property="creTime"/>
      <result column="reply_time" javaType="java.util.Date" jdbcType="TIMESTAMP" property="replyTime"/>
      <result property="articleId" column="article_id"></result>
      <result column="level" property="level"></result>
      <result column="parent_name" property="parentName"></result>
      <collection property="comments" column="comment_id" select="edu.tjdz.blog.dao.CommentMapper.listChildCommentByParentId"></collection>
  </resultMap>

  <select id="listCommentByArticleId" resultMap="BaseResultMap">
    select * from comment where article_id = #{articleId} and level=1 order by cre_time desc;
  </select>

  <select id="listChildCommentByParentId" resultMap="BaseResultMap">
    select * from comment where parent_id = #{comment_id} order by cre_time desc;
  </select>

  <insert id="addComment" parameterType="Comment">
    <selectKey resultType="_int" keyProperty="articleId" order="AFTER">
      select @@IDENTITY as CommentId
    </selectKey>
    insert into comment values(#{commentId},	#{commentContent},	#{touristName},	#{touristImg},#{email},	#{creTime},	#{replyTime},#{parentName},#{parentId}, #{articleId},#{level})
  </insert>

  <select id="getCommentByCommentId" resultMap="BaseResultMap">
    select *from comment  where comment_id = #{commentId}
  </select>

  <delete id="delCommentByCommentId" parameterType="Integer">
    delete comment where comment_id=#{commentId}
  </delete>



</mapper>